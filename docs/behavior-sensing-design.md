# AIPointer — 智能行为感知方案

> **目的**：对齐思路，确认设计方向。不是技术规格文档。
>
> **日期**：2026-02-14
> **版本**：v2（整合讨论反馈）

---

## 一句话概括

AIPointer 观察用户的操作行为，在发现"AI 能帮上忙"的时刻主动提示用户 — 用户不需要打开任何对话窗口，不需要描述自己在干什么，甚至不需要知道 AI 能帮什么。

---

## 核心理念

**用户的问题不是"AI 不够强"，而是"不知道什么时候该找 AI"。**

AIPointer 要做的不是替用户干活（那是 OpenClaw 的事），而是在正确的时刻告诉用户："你现在做的这件事，其实不用自己来。"

> *You don't find AI. AI finds you.*

---

## 角色分工

| 角色 | 职责 | 比喻 |
|------|------|------|
| **AIPointer** | 观察用户行为，采集数据，用本地规则判断"值不值得问 AI" | 眼睛 |
| **OpenClaw（aipointer agent）** | 分析行为数据，判断自己能不能帮忙，给出建议或直接执行 | 大脑 + 手 |

AIPointer 有眼睛但没脑子。OpenClaw 有脑子有手但是瞎的。合在一起才完整。

OpenClaw 端使用独立的 `aipointer` agent（Sonnet 4.5），与主 agent 互不干扰。该 agent 性格调皮简短，响应快。

---

## 两层检测机制

### 第一层：本地规则引擎（AIPointer 端，实时）

**只回答一个问题："用户现在忙不忙？"**

不判断用户在做什么，不判断 AI 能帮什么，不按应用做特殊规则。只看通用的行为模式。

**评分系统**（2 分钟滑动窗口）：

| 信号 | 条件 | 分数 |
|------|------|------|
| 跨应用高频切换 | 同一对应用之间来回切换 ≥6 次 | +3 |
| 剪贴板高频变化 | 剪贴板内容变化 ≥4 次 | +3 |
| 剪贴板内容结构相似 | 最近 4 次内容长度相近、字符类型相似 | +2 |
| 同应用长时间停留 + 低产出 | 停留 >3 分钟，焦点频繁变化但内容增长慢 | +2 |
| 浏览器多 tab 切换 | 同一 Chrome 进程内 tab 切换 ≥5 次 | +2 |
| Finder 连续文件操作 | 连续重命名或移动文件 ≥5 次 | +2 |

**触发阈值：≥5 分**

滑动窗口是真正的滑动 — 任何时刻看"从现在往前 2 分钟"的事件，每次新事件进来就重新计算。不存在窗口边界的遗漏问题。

**门槛故意设得低。** 宁可多问几次 OpenClaw，也不漏掉该提示的场景。OpenClaw 自己会过滤掉不该介入的情况。

**不做场景级别的规则。** 不需要预定义"Excel → 飞书是数据搬运"这类规则。规则引擎只管"忙不忙"，具体是什么场景、能不能帮忙，全交给 OpenClaw 判断。

### 第二层：LLM 智能判断（OpenClaw 端，按需触发）

OpenClaw 收到行为记录后，自己判断：

1. 用户在做什么？
2. 这件事痛苦吗？
3. 我有能力帮忙吗？
4. 用户接受帮助的成本低吗？

根据判断结果分三级响应：

| 置信度 | OpenClaw 行为 | AIPointer 展示 |
|--------|-------------|---------------|
| **高** — 知道用户在干什么，知道怎么帮 | 返回具体的观察 + 建议 | 指针提示 + 等待 Fn |
| **中** — 大概知道用户在忙，但不确定细节 | 返回观察，不主动给建议 | 指针提示 + 等待 Fn |
| **低 / 帮不上** | 返回不介入 | 用户无感知 |

**为什么不用规则引擎覆盖所有场景？** 因为瓶颈会卡在定义规则的人身上。能想到的场景有限，LLM 能自己推理。没人比 OpenClaw 更了解自己能干什么。

---

## 行为数据采集

### 采集什么

| 数据 | 来源 | 说明 |
|------|------|------|
| 活跃应用名称 | NSWorkspace 通知 | 知道用户在用什么工具 |
| 窗口标题 | AX API | 知道用户在操作什么文件/页面 |
| 窗口切换频率 | 计数器 | 判断是否在频繁跨应用操作 |
| 剪贴板内容摘要 | NSPasteboard（前 200 字符） | 知道用户在搬什么数据 |
| 剪贴板变化频率 | changeCount 轮询 | 判断是否在频繁复制粘贴 |
| 鼠标悬停位置的 UI 元素 | AX API（鼠标停留 >1s 时采样） | 用户注意力所在位置的具体内容和结构 |
| 点击位置的 UI 元素 | AX API（点击时采样） | 用户正在操作什么 |
| 复制操作时的源上下文 | AX API（Cmd+C 时采样） | 剪贴板内容在什么上下文里 |
| 浏览器 URL | 窗口标题提取 | 知道用户在看什么网站 |

### 鼠标/点击位置的 AX 采样

macOS AX API 可以根据屏幕坐标获取该位置的 UI 元素（`AXUIElementCopyElementAtPosition`）。

拿到元素后可读取：
- **元素类型**：`AXRole`（按钮？输入框？表格单元格？文本段落？）
- **元素文本**：`AXValue` / `AXTitle`
- **父容器结构**：`AXParent` 向上遍历（属于什么表格？什么列表？）
- **相邻元素**：同级 `AXChildren`（表格的其他列内容、表头等）
- **所属应用**：`AXPid` → 应用名

**采样时机：**
- 鼠标悬停 >1 秒（用户在看某个东西）
- 点击时（用户在操作某个东西）
- Cmd+C 时（复制操作的源上下文）

不持续采样移动中的鼠标位置 — 没有意义。

**这是判断质量的核心差异。** 没有 AX 上下文，OpenClaw 只知道"用户在 Excel 和 Chrome 之间切换"。有了 AX 上下文，OpenClaw 能知道"用户在把一张有 分公司/季度/金额 三列的销售表搬到飞书"。

**AX 信息丰富度因应用而异：**
- Excel / Word / Apple 原生 App → 非常丰富（单元格内容、表格结构、文档文本）
- Chrome（Enhanced AX 开启后）→ 丰富（DOM 元素、文本、表单属性）
- Slack / Notion（Electron）→ 基本够用
- Adobe 系列 → 很差（画布内容读不到）

好消息：AX 信息丰富的应用恰好是 OpenClaw 能帮上忙的那些。AX 信息差的应用，OpenClaw 本来也帮不上。天然过滤。

### 怎么存

**环形缓冲区**：内存中保留最近 5 分钟的事件，最多 200 条。约 60KB。

不写磁盘，不发网络，纯内存。应用退出即消失。

### 发给 OpenClaw 前的压缩

不把 5 分钟原始事件全发过去。压缩方式：
- 合并相似事件（连续 3 次从 Excel 复制 → "从 Excel 复制了 3 次，内容分别是..."）
- 只取最近 2-3 分钟
- AX 上下文只保留最有信息量的部分（表格 headers、输入框 placeholder）
- 目标：压缩后 500-1000 字符

---

## 触发 → 分析 → 提示 → 交互 流程

```
用户正常操作
    │
    ├── AIPointer 持续记录行为到环形缓冲区（极低开销）
    ├── 每个事件同时更新评分系统的滑动窗口
    │
    ├── 分数 < 5 → 继续观察，什么都不做
    │
    └── 分数 ≥ 5 →
            │
            ├── 从缓冲区取最近 2-3 分钟的记录
            ├── 采集当前鼠标/焦点位置的 AX 上下文
            ├── 压缩打包，发送给 OpenClaw（aipointer agent）
            │
            └── OpenClaw 返回判断：
                │
                ├── 高置信度 →
                │   指针样式变化（类似验证码提示）
                │   显示轻量文案
                │   等待用户按 Fn 键
                │       └── 用户按 Fn →
                │           打开对话面板
                │           面板预填 AI 的具体建议
                │           用户确认 → AI 执行
                │
                ├── 中置信度 →
                │   指针样式变化
                │   显示轻量文案
                │   等待用户按 Fn 键
                │       └── 用户按 Fn →
                │           打开对话面板
                │           面板预填 AI 的观察
                │           等待用户输入补充说明
                │           AI 根据补充信息给建议
                │
                └── 低置信度 / 帮不上 →
                    用户无感知
```

### 关于 UI 交互

**不需要新的 UI 组件。** 所有交互回到 AIPointer 已有的对话面板。

行为感知唯一新增的 UI 是**指针样式变化 + 轻量文案**（跟验证码提示复用同一套视觉语言）。用户按 Fn 打开对话面板后，区别只在于面板里是否预填了内容。

**统一入口：Fn 键。** 无论是主动聊天、验证码确认、还是行为感知建议，都通过 Fn 键触发。用户只需要记住一个操作。

---

## 隐私边界

- 剪贴板只记录前 200 字符
- 检测到高熵随机字符串（疑似密码）时记录为 `[REDACTED]`
- 所有数据纯内存，不写磁盘
- 发给 OpenClaw 的数据走本地回环（localhost），不出机器
- 用户可以随时关闭行为感知功能

---

## 剪贴板"结构相似"判断规则

取最近 4 次剪贴板内容，做两个检查：

**检查 1：长度一致性**

4 条内容中，最长的不超过最短的 3 倍 → 通过。

**检查 2：字符类型一致性**

给每条内容打类型标签：
- 主要是中文 → `chinese`
- 主要是英文 → `english`
- 主要是数字（含货币符号、小数点）→ `numeric`
- 混合 → `mixed`

4 条中 ≥3 条类型标签相同 → 通过。

**综合：两个检查都通过 → 判定为"结构相似"（+2 分）。只通过一个 → 不加分。**

示例：

| 剪贴板内容 | 长度 | 类型 | 结果 |
|-----------|------|------|------|
| "张三" "李四" "王五" "赵六" | ✅ | ✅ chinese | 相似 |
| "¥2,450,000" "¥1,870,000" "¥3,200,000" "¥980,000" | ✅ | ✅ numeric | 相似 |
| "a@mail.com" "b@mail.com" "c@mail.com" "d@mail.com" | ✅ | ✅ english | 相似 |
| "张三" "¥2,450,000" "上海" "Q4" | ✅ | ❌ 混杂 | 不相似 |
| "一段很长的文本..." "短" "中" "很长很长..." | ❌ | ✅ chinese | 不相似 |

注意：结构相似只是 +2 加分项，不是触发的必要条件。跨应用切换（+3）+ 剪贴板频率（+3）本身就能达到阈值。

---

## 第一版不做的东西

- ~~冷却机制~~ — 触发多了就触发多了，后续根据实际体验再加
- ~~场景优先级~~ — 不预定义场景，OpenClaw 自行判断
- ~~输入产出比检测~~ — "打字多但内容增长慢"的信号实现复杂度高，后续再加
- ~~按应用做特殊规则~~ — 规则引擎保持通用

---

## 开放问题

~~1. 评分系统的权重和阈值~~ — Settings 里暴露灵敏度调节。✅

~~2. "结构相似"判断精度~~ — 长度一致性 + 字符类型一致性，双检查通过才算。✅

~~3. 提示消失时机~~ — 4 秒后消失。✅

**所有开放问题已确认。可以进入技术规格文档阶段。**

---

_确认无误后，下一步出技术规格文档。_
